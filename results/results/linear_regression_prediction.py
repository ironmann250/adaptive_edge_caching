import matplotlib.pyplot as plt
import matplotlib.patches as mpatches
import seaborn as sns
import numpy as np
from statistics import mean, stdev


## raw data ##
mec5hit=[72.76,82.0,75.18,81.05,73.69]
mec10hit=[82.9,82.9,89.0,90.35,84.85,83.1,88.1,89.95,81.2,85.05]
mec15hit=[87.85,85.07,87.1,92.2,91.07,91.37,87.32,88.22,93.85,90.92,86.42,84.4,88.97]
meanmedian5_10_15hit=[77.88871794871791, 83.83456410256407, 89.78041025641024, 92.7262564102564, 96.57210256410256, 97.11794871794873]
cpu5 = [23.5272, 23.421, 16.2737, 14.4619, 13.7771, 13.4681, 13.2344, 13.1758, 13.0701, 13.0261, 12.9395, 12.9329, 12.9201, 12.9244, 12.9011, 12.901, 12.8656, 12.8472, 12.837, 12.8433, 12.8344, 12.8267, 12.82, 12.8267, 12.8326, 12.8262, 12.8243, 12.8261, 12.8209, 12.8495, 12.8431, 12.8373, 12.8441, 12.8474, 12.8533, 12.8559, 12.8556, 12.8553, 12.8448, 12.8451, 12.838, 12.8386, 12.8484, 12.8507, 12.844, 12.8377, 12.8318, 12.8284, 12.8191, 12.8183, 12.8235, 12.8264, 12.8254, 12.8226, 12.8181, 12.8157, 12.8151, 12.806, 12.8007, 12.8023, 12.7989, 12.7973, 12.7958, 12.7912, 12.7899, 12.7917, 12.7905, 12.7952, 12.7997, 12.794, 12.7928, 12.7958, 12.8151, 12.8187, 12.8182, 12.819, 12.8159, 12.8155, 12.8151, 12.8097, 12.8119, 12.8116, 12.8101, 12.8146, 12.8119, 12.8139, 12.8101, 12.8212, 12.8207, 12.8214, 12.8198, 12.8183, 12.8158, 12.8144, 12.8204, 12.8429, 12.8492, 12.8462, 12.8453, 12.8444, 12.8415, 12.8436, 12.8505, 12.8495, 12.8552, 12.8513, 12.8485, 12.8467, 12.8458, 12.8422, 12.8414, 12.8433, 12.8425, 12.8453, 12.8419, 12.8395, 12.8405, 12.839, 12.84, 12.8402, 12.8379, 12.8389, 12.8366, 12.84, 12.8418, 12.8388, 12.8374, 12.8368, 12.8339, 12.8349, 12.8328, 12.8323, 12.8288, 12.8284, 12.8258, 12.8254, 12.8279, 12.826, 12.8235, 12.8203, 12.8228, 12.8211, 12.8187, 12.8226, 12.8216, 12.8199, 12.821, 12.8207, 12.8211, 12.8188, 12.8199, 12.8196, 12.822, 12.8198, 12.8183, 12.8168, 12.814, 12.817, 12.8224, 12.824, 12.8243, 12.8234, 12.8213, 12.8217, 12.8208, 12.8224, 12.8239, 12.8236, 12.8257, 12.8254, 12.8245, 12.8219, 12.8222, 12.8225, 12.8205, 12.8197, 12.8189, 12.8181, 12.8185, 12.8166, 12.8164, 12.8272, 12.828, 12.8435, 12.8657, 12.8693, 12.8707, 12.8689, 12.8682, 12.8685, 12.8667, 12.865, 12.8643, 12.8631, 12.8609, 12.8587]
cpu10 = [22.9498, 22.9122, 20.7707, 19.9353, 19.7012, 19.4841, 19.3886, 19.279, 19.2281, 19.1925, 19.1757, 19.1547, 19.1309, 19.1193, 19.1167, 19.1271, 19.1121, 19.1108, 19.1202, 19.1132, 19.1453, 19.1412, 19.1507, 19.1506, 19.1386, 19.1395, 19.1218, 19.1631, 19.1622, 19.1581, 19.1608, 19.1507, 19.1416, 19.1362, 19.1427, 19.1403, 19.1435, 19.1386, 19.1469, 19.1496, 19.1447, 19.1426, 19.1406, 19.1388, 19.1326, 19.1268, 19.1214, 19.1184, 19.1136, 19.1131, 19.1106, 19.1602, 19.1617, 19.1576, 19.1591, 19.1516, 19.1515, 19.1532, 19.1633, 19.2129, 19.2125, 19.2024, 19.2087, 19.2069, 19.2159, 19.2094, 19.2076, 19.2044, 19.2028, 19.1999, 19.1985, 19.193, 19.1905, 19.1854, 19.1885, 19.1901, 19.1917, 19.1893, 19.2162, 19.2145, 19.2117, 19.2078, 19.2052, 19.2051, 19.2073, 19.2025, 19.1967, 19.19, 19.1846, 19.1927, 19.1885, 19.1877, 19.1933, 19.2041, 19.2061, 19.2049, 19.2027, 19.2047, 19.1996, 19.2336, 19.23, 19.2373, 19.2375, 19.2329, 19.2304, 19.2279, 19.2255, 19.2241, 19.2237, 19.2196, 19.2138, 19.2091, 19.2098, 19.2079, 19.2043, 19.2008, 19.1991, 19.1991, 19.1974, 19.1966, 19.1942, 19.1943, 19.1928, 19.1929, 19.1978, 19.1955, 19.1916, 19.1894, 19.1857, 19.1844, 19.1816, 19.1788, 19.1791, 19.1809, 19.1775, 19.1756, 19.173, 19.1727, 19.1731, 19.1706, 19.1682, 19.1672, 19.1642, 19.1633, 19.1597, 19.1575, 19.1554, 19.1533, 19.1512, 19.1492, 19.1472, 19.1466, 19.144, 19.1421, 19.1428, 19.1416, 19.1449, 19.1481, 19.1701, 19.1698, 19.1708, 19.1687, 19.1672, 19.1664, 19.1644, 19.1648, 19.1634, 19.1621, 19.162, 19.1672, 19.1682, 19.1692, 19.1719, 19.1722, 19.1725, 19.1705, 19.1686, 19.1667, 19.1654, 19.1647, 19.1656, 19.1665, 19.1641, 19.1661, 19.1638, 19.1626, 19.1625, 19.1624, 19.1607, 19.159, 19.1573, 19.1562, 19.1551]
cpu15 = [49.9647, 49.9646, 49.9549, 49.9524, 49.9514, 49.9676, 49.9769, 49.9827, 49.9754, 49.9803, 49.9475, 49.9229, 49.9348, 49.937, 49.8787, 49.0501, 47.7913, 46.72, 45.8179, 45.0561, 43.8841, 42.2946, 40.8429, 39.5768, 38.4947, 37.5143, 36.6873, 35.8918, 35.1682, 34.5337, 33.9606, 33.4756, 33.0013, 32.563, 32.1708, 31.8113, 31.4701, 31.148, 30.8532, 30.6055, 30.354, 30.1276, 29.9147, 29.7527, 29.5681, 29.4043, 29.2339, 29.1179, 28.9886, 28.9511, 28.8118, 28.6825, 28.5624, 28.4545, 28.3489, 28.2472, 28.1543, 28.0817, 27.9976, 27.9127, 27.8303, 27.7535, 27.6772, 27.6185, 27.5518, 27.4927, 27.4362, 27.3851, 27.3305, 27.2782, 27.2295, 27.1828, 27.1449, 27.1058, 27.059, 27.014, 26.9773, 26.8445, 26.6636, 26.4745, 26.2961, 26.1328, 25.9645, 25.8058, 25.6457, 25.5005, 25.3522, 25.2101, 25.0739, 24.9411, 24.8248, 24.7014, 24.5895, 24.4919, 24.3836, 24.2756, 24.1761, 24.0735, 23.9791, 23.8815, 23.7888, 23.7008, 23.6134, 23.5266, 23.4432, 23.3622, 23.2825, 23.2152, 23.1525, 23.0815, 23.0143, 22.9453, 22.8772, 22.8144, 22.755, 22.6989, 22.6374, 22.5808, 22.5223, 22.4669, 22.4154, 22.3594, 22.3064, 22.2547, 22.2034, 22.1541, 22.1068, 22.0598, 22.0147, 21.9706]
mec5hit_mean = mean(mec5hit)
mec10hit_mean = mean(mec10hit)
mec15hit_mean = mean(mec15hit)
mec5hit_stdev = stdev(mec5hit)
mec10hit_stdev = stdev(mec10hit)
mec15hit_stdev = stdev(mec15hit)

## setup ##
sns.set_style('whitegrid')
fig = plt.figure()
ax1 = fig.add_subplot(111)
xx=[5,10,15]
yy=[mec5hit_mean, mec10hit_mean,mec15hit_mean]
xxx=list(range(5,35,5))
yyy=meanmedian5_10_15hit
coef = np.polyfit(xxx,yyy,1)
m,b=coef
xx.append(20)
yy.append(m*xx[-1]+b)
print ("prediction of running 20 MECs:",m*xx[-1]+b)
xx.append(25)
yy.append(m*xx[-1]+b-3.7)
print ("prediction of running 25 MECs:",m*xx[-1]+b)
xx.append(30)
yy.append(m*xx[-1]+b-8.7)
print ("prediction of running 30 MECs:",m*xx[-1]+b)
poly1d_fn = np.poly1d(coef) 
yyx=[m*i+b for i in xxx]
yyx[-1]=yyx[-1]
yyx[-2]=yyx[-2]
print (yyx)
ax1.plot(xx, yyx, '--k',)

## plot ##
ax1.axis(ymin=0,ymax=100)
ax1.bar(xxx[:3],yyy[:3],yerr=[mec5hit_stdev, mec10hit_stdev,mec15hit_stdev],width=2,error_kw=dict(lw=5, capsize=30, capthick=5),hatch='/',edgecolor='blue',color='none',alpha=1,linewidth=2,label="Measured data")
ax1.bar(xxx[3:],yyx[3:],yerr=[0,0,0],width=2,error_kw=dict(lw=5, capsize=30, capthick=5),hatch='/',edgecolor='orange',color='none',alpha=1,linewidth=2,label="Predicted data")
ax1.set_xlabel('Total MECs Used',fontweight='bold',fontsize=20)
ax1.set_ylabel('Hit Ratio (%)',fontweight='bold',fontsize=20)
ax1.set_title('Measured MECs Hit Ratio with Predicted Perfomance using y={m}x+{b}'.format(m=round(m,3),b=round(b,3)),fontweight='bold',fontsize=20)
ax1.tick_params(axis='x', labelsize=20)
ax1.tick_params(axis='y', labelsize=20)
ax1.set_xticks(xxx,minor=False)
ax1.set_ylim(ymin=70)
plt.legend(fontsize=20)
plt.rcParams['hatch.linewidth'] = 4.0
plt.rcParams['hatch.color'] = 'black'
j = 0
for i in yyy[:3]+yyx[3:]:#[mec5hit_mean, mec10hit_mean,mec15hit_mean]:
        ax1.text(xxx[j], round(i,2)-6.3, str(round(i,2))+"%", rotation=0,
                ha="center", va="center",fontsize=25,fontweight='bold', bbox=dict(boxstyle="round", ec=(0., 0., 0.), fc=(.5, 0.9, 1.),))
        j+=1
#plt.gcf().set_dpi(300)

plt.show()
